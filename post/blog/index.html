<!doctype html>
<html lang="en-us">
  <head>
    <title>ArrayList源码解读 // My New Hugo Site</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://zzhorun.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ArrayList源码解读"/>
<meta name="twitter:description" content="ArrayList源码解读： 特点说明：  ArrayList底层是数组队列，相当于动态数组。和java的数组相比，它的容量能动态增长。当添加大量的元素时，应用程序可以通过扩容机制来增加ArrayList实例的容量。这可以减少递增式再分配的数量。 同样的由于ArrayList和LinkedList二者的结构不同，在增删查改方面的速度也是大不一样的。对于ArrayList来说，线性表的顺序存储，插入、删除元素的时间复杂度为O(n)，求表长以及增加元素，取第i元素的时间复杂度为O(1) LinkedList不支持高效的随机元素访问，而ArrayList支持。 ArrayList的空间浪费主要体现在list列表的结尾会预留一定的容量空间，而LinkedList的空间花费则体现在它的每一个元素都需要消耗比ArrayList更多的空间(因为要存放直接后继和直接前驱以及数据)。  关键字解读： RandomAccess：RandomAccess这个是ArrayList所实现的随机接入接口。从源码中看这个接口中并没有任何的内容。只是作为一个标示，标记当前的接口具有随机访问功能，所以并不是说ArrayList实现了RandomAccess接口才具有快速随机访问功能的。
函数解读：(针对ArrayList扩容的源代码放在最后) 1. trimToSize函数：简单来说就是对当前的ArrayList进行瘦身。 private static final Object[] EMPTY_ELEMENTDATA = {}; ....... public void trimToSize(){ modCount &#43;&#43;; if(size &lt; elementData.length) { elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); } } 2. ArrayList带集合参数的构造函数： 构造一个包含指定集合的元素的列表。 public ArrayList(Collection&lt;? extends E&gt; c) { elementData = c.toArray(); //如果指定集合元素个数不为0  if ((size = elementData.length) != 0) { // c.toArray 可能返回的不是Object类型的数组，所以加上下面的语句用于判断，  //这里用到了反射里面的getClass()方法  if (elementData."/>

    <meta property="og:title" content="ArrayList源码解读" />
<meta property="og:description" content="ArrayList源码解读： 特点说明：  ArrayList底层是数组队列，相当于动态数组。和java的数组相比，它的容量能动态增长。当添加大量的元素时，应用程序可以通过扩容机制来增加ArrayList实例的容量。这可以减少递增式再分配的数量。 同样的由于ArrayList和LinkedList二者的结构不同，在增删查改方面的速度也是大不一样的。对于ArrayList来说，线性表的顺序存储，插入、删除元素的时间复杂度为O(n)，求表长以及增加元素，取第i元素的时间复杂度为O(1) LinkedList不支持高效的随机元素访问，而ArrayList支持。 ArrayList的空间浪费主要体现在list列表的结尾会预留一定的容量空间，而LinkedList的空间花费则体现在它的每一个元素都需要消耗比ArrayList更多的空间(因为要存放直接后继和直接前驱以及数据)。  关键字解读： RandomAccess：RandomAccess这个是ArrayList所实现的随机接入接口。从源码中看这个接口中并没有任何的内容。只是作为一个标示，标记当前的接口具有随机访问功能，所以并不是说ArrayList实现了RandomAccess接口才具有快速随机访问功能的。
函数解读：(针对ArrayList扩容的源代码放在最后) 1. trimToSize函数：简单来说就是对当前的ArrayList进行瘦身。 private static final Object[] EMPTY_ELEMENTDATA = {}; ....... public void trimToSize(){ modCount &#43;&#43;; if(size &lt; elementData.length) { elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); } } 2. ArrayList带集合参数的构造函数： 构造一个包含指定集合的元素的列表。 public ArrayList(Collection&lt;? extends E&gt; c) { elementData = c.toArray(); //如果指定集合元素个数不为0  if ((size = elementData.length) != 0) { // c.toArray 可能返回的不是Object类型的数组，所以加上下面的语句用于判断，  //这里用到了反射里面的getClass()方法  if (elementData." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zzhorun.github.io/post/blog/" />
<meta property="article:published_time" content="2020-11-24T22:56:46+08:00" />
<meta property="article:modified_time" content="2020-11-24T22:56:46+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://zzhorun.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>My New Hugo Site</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
      <div class="app-header-social">
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">ArrayList源码解读</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 24, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <h4 id="arraylist源码解读">ArrayList源码解读：</h4>
<h5 id="特点说明">特点说明：</h5>
<ol>
<li>ArrayList底层是数组队列，相当于动态数组。和java的数组相比，它的容量能动态增长。当添加大量的元素时，应用程序可以通过扩容机制来增加ArrayList实例的容量。这可以减少递增式再分配的数量。</li>
<li>同样的由于ArrayList和LinkedList二者的结构不同，在增删查改方面的速度也是大不一样的。对于ArrayList来说，线性表的顺序存储，插入、删除元素的时间复杂度为O(n)，求表长以及增加元素，取第i元素的时间复杂度为O(1)</li>
<li>LinkedList不支持高效的随机元素访问，而ArrayList支持。</li>
<li>ArrayList的空间浪费主要体现在list列表的结尾会预留一定的容量空间，而LinkedList的空间花费则体现在它的每一个元素都需要消耗比ArrayList更多的空间(因为要存放直接后继和直接前驱以及数据)。</li>
</ol>
<h5 id="关键字解读">关键字解读：</h5>
<p><strong>RandomAccess</strong>：RandomAccess这个是ArrayList所实现的随机接入接口。从源码中看这个接口中并没有任何的内容。只是作为一个标示，标记当前的接口具有随机访问功能，所以并不是说ArrayList实现了RandomAccess接口才具有快速随机访问功能的。</p>
<h5 id="函数解读针对arraylist扩容的源代码放在最后">函数解读：(针对ArrayList扩容的源代码放在最后)</h5>
<h6 id="1-trimtosize函数简单来说就是对当前的arraylist进行瘦身">1. trimToSize函数：简单来说就是对当前的ArrayList进行瘦身。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> EMPTY_ELEMENTDATA <span style="color:#f92672">=</span> <span style="color:#f92672">{};</span>
<span style="color:#f92672">.......</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">trimToSize</span><span style="color:#f92672">(){</span>
    modCount <span style="color:#f92672">++;</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>size <span style="color:#f92672">&lt;</span> elementData<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        elementData <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>size <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">?</span> EMPTY_ELEMENTDATA <span style="color:#f92672">:</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="2-arraylist带集合参数的构造函数-构造一个包含指定集合的元素的列表">2. ArrayList带集合参数的构造函数： 构造一个包含指定集合的元素的列表。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ArrayList</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> E<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        elementData <span style="color:#f92672">=</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//如果指定集合元素个数不为0
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>size <span style="color:#f92672">=</span> elementData<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// c.toArray 可能返回的不是Object类型的数组，所以加上下面的语句用于判断，
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//这里用到了反射里面的getClass()方法
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>elementData<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> Object<span style="color:#f92672">[].</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
                elementData <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">,</span> Object<span style="color:#f92672">[].</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 用空数组代替
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">elementData</span> <span style="color:#f92672">=</span> EMPTY_ELEMENTDATA<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h6 id="3-contains函数输入参数是一个object对象如果当前arraylist中存在这个对象的话就返回true否则返回false调用关系如下图">3. contains函数：输入参数是一个Object对象，如果当前ArrayList中存在这个对象的话，就返回true，否则返回false。调用关系如下图：</h6>
<pre><code class="language-mermaid" data-lang="mermaid">graph LR
contains--&gt;indexOf
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> indexOf<span style="color:#f92672">(</span>o<span style="color:#f92672">)</span> <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">indexOf</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//返回传入对象o第一次出现时的下标
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#75715e">//首先判断传入的参数o是不是null
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> i <span style="color:#f92672">++)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>i<span style="color:#f92672">]==</span><span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0 <span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> i <span style="color:#f92672">++)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>i<span style="color:#f92672">]))</span>
                <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="4-lastindexof函数该函数和indexof函数类似但是该函数是为了得到传入参数最后一次出现在arraylist实例中的下标">4. lastIndexOf函数：该函数和indexOf函数类似，但是该函数是为了得到传入参数最后一次出现在ArrayList实例中的下标。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lastIndexOf</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> size <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span> i<span style="color:#f92672">--)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>i<span style="color:#f92672">]==</span><span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> size <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span> i<span style="color:#f92672">--)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>i<span style="color:#f92672">]))</span>
                <span style="color:#66d9ef">return</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="5-clone函数这个函数的目的是拷贝当前arraylist实例中的值">5. clone函数：这个函数的目的是拷贝当前ArrayList实例中的值。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">clone</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
        ArrayList<span style="color:#f92672">&lt;?&gt;</span> v <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;?&gt;)</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clone</span><span style="color:#f92672">();</span>
        v<span style="color:#f92672">.</span><span style="color:#a6e22e">elementData</span> <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">);</span>
        v<span style="color:#f92672">.</span><span style="color:#a6e22e">modCount</span> <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">return</span> v<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>CloneNotSupportedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">//this shouldn&#39;t happen, since we are Cloneable
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InternalError<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="6-toarray函数-该函数以正确的顺序从第一个到最后一个元素返回一个包含此列表中所有元素的数组返回的数组将是安全的换句话说这个方法分配一个新的数组调用者可以自由地修改返回的数组">6. toArray函数： 该函数以正确的顺序(从第一个到最后一个元素)返回一个包含此列表中所有元素的数组。返回的数组将是“安全的”，换句话说，这个方法分配一个新的数组，调用者可以自由地修改返回的数组。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> Object<span style="color:#f92672">[]</span> <span style="color:#a6e22e">toArray</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="7--toarray函数2简单地说这个函数和上面的函数的区别也就是该函数的返回类型是以所传入的数组对象的参数决定的首先判断传入参数数组的length和arraylist实例的size哪个大如果arraylist实例的size大于传入参数数组对象的length那么就使用arrayscopyof函数将arraylist实例中的所有值拷贝到一个类型为t的数组并返回这个新的数组如果arraylist实例的size小于传入参数数组的length也就是alength那么就先调用systemarraycopy函数将数组a中的0size的值变成arraylist实例的值然后将剩下的设置成null">7.  toArray函数2：简单地说这个函数和上面的函数的区别也就是，该函数的返回类型是以所传入的数组对象的参数决定的，首先判断传入参数数组的length和ArrayList实例的size哪个大？如果ArrayList实例的size大于传入参数数组对象的length，那么就使用Arrays.copyOf函数将ArrayList实例中的所有值拷贝到一个类型为T的数组并返回这个新的数组；如果ArrayList实例的size小于传入参数数组的length(也就是a.length)，那么就先调用System.arraycopy函数将数组a中的0~size的值变成ArrayList实例的值，然后将剩下的设置成null。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T<span style="color:#f92672">[]</span> <span style="color:#a6e22e">toArray</span><span style="color:#f92672">(</span>T<span style="color:#f92672">[]</span> a<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>a<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">)</span>
        <span style="color:#75715e">// 新建一个运行时类型的数组，但是ArrayList数组的内容
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>T<span style="color:#f92672">[])</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">,</span> a<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">//调用System提供的arraycopy()方法实现数组之间的复制
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> a<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> size<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>a<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> size<span style="color:#f92672">)</span>
        a<span style="color:#f92672">[</span>size<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">return</span> a<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="8-解释toarray1和toarray2的区别总结一下其实alength和size之间的大小除了决定返回数组的值之外还决定了我们使用的是哪一种拷贝方法使用arrayscopyof方法的话会新创建一个以a数组类型为类型但是以arraylist实例的size为长度的数组对象而systemarraycopy函数就不会创建新的数组对象下面将放上arrayscopyof的源码arrayscopyof方法其实也会调用systemarraycopy方法">8. 解释toArray1和toArray2的区别：总结一下其实a.length和size之间的大小，除了决定返回数组的值之外还决定了我们使用的是哪一种拷贝方法，使用Arrays.copyOf方法的话，会新创建一个以a数组类型为类型，但是以ArrayList实例的size为长度的数组对象；而System.arraycopy函数就不会创建新的数组对象。下面将放上Arrays.copyOf的源码。(Arrays.copyOf方法其实也会调用System.arraycopy方法。)</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T<span style="color:#f92672">[]</span> <span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>T<span style="color:#f92672">[]</span> original<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> newLength<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>T<span style="color:#f92672">[])</span> copyOf<span style="color:#f92672">(</span>original<span style="color:#f92672">,</span> newLength<span style="color:#f92672">,</span> original<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">,</span>U<span style="color:#f92672">&gt;</span> T<span style="color:#f92672">[]</span> <span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>U<span style="color:#f92672">[]</span> original<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> newLength<span style="color:#f92672">,</span> Class<span style="color:#f92672">&lt;?</span> entends T<span style="color:#f92672">[]&gt;</span> newType<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
    T<span style="color:#f92672">[]</span> copy <span style="color:#f92672">=</span> <span style="color:#f92672">((</span>Object<span style="color:#f92672">)</span>newType <span style="color:#f92672">==</span> <span style="color:#f92672">(</span>Object<span style="color:#f92672">)</span>Object<span style="color:#f92672">[].</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">?</span> <span style="color:#f92672">(</span>T<span style="color:#f92672">[])</span> <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[</span>newLength<span style="color:#f92672">]</span>
        <span style="color:#f92672">:</span> <span style="color:#f92672">(</span>T<span style="color:#f92672">[])</span> Array<span style="color:#f92672">.</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(</span>newType<span style="color:#f92672">.</span><span style="color:#a6e22e">getComponentType</span><span style="color:#f92672">(),</span> newLength<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>original<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> copy<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">min</span><span style="color:#f92672">(</span>original<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">,</span> newLength<span style="color:#f92672">));</span>
    <span style="color:#66d9ef">return</span> copy<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="9-remove函数这个函数主要将传入的index下标所在位置的元素删除将index之后的所有元素往前移一位然后返回被删除的这个元素的值">9. remove函数：这个函数主要将传入的index下标所在位置的元素删除，将index之后的所有元素往前移一位，然后返回被删除的这个元素的值：</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> E <span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    rangeCheck<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
    
    modCount<span style="color:#f92672">++;</span>
    E oldValue <span style="color:#f92672">=</span> elementData<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
    
    <span style="color:#66d9ef">int</span> numMoved <span style="color:#f92672">=</span> size <span style="color:#f92672">-</span> index <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>numMoved <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">+</span>1<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> numMoved<span style="color:#f92672">);</span>
    elementData<span style="color:#f92672">[--</span>size<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">//clear to let GC do its work
</span><span style="color:#75715e"></span>    
    <span style="color:#66d9ef">return</span> oldValue<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="10-remove与fastremove函数remove函数是删除arraylist中首次出现的值与object-o相同的元素">10. remove与fastRemove函数：remove函数是删除ArrayList中首次出现的值与Object o相同的元素。</h6>
<pre><code class="language-mermaid" data-lang="mermaid">graph LR
remove--&gt;fastRemove
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> index <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> index<span style="color:#f92672">++)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                fastRemove<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> index <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> index<span style="color:#f92672">++)</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>o<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>index<span style="color:#f92672">]))</span> <span style="color:#f92672">{</span>
                fastRemove<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fastRemove</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    modCount<span style="color:#f92672">++;</span>
    <span style="color:#66d9ef">int</span> numMoved <span style="color:#f92672">=</span> size <span style="color:#f92672">-</span> index <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>numMoved <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">+</span>1<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> numMoved<span style="color:#f92672">);</span>
    elementData<span style="color:#f92672">[--</span>size<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">//clear to let GC do its work
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h6 id="11-retainall和removeall函数-retainall函数功能是留下arraylist示例与传入参数collection集合共有的元素removeall函数函数功能是删除arraylist示例与传入参数collection集合中共有的参数">11. retainAll和removeAll函数: retainAll函数功能是留下ArrayList示例与传入参数collection集合共有的元素。removeAll函数函数功能是删除ArrayList示例与传入参数collection集合中共有的参数。</h6>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">removeAll</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">requireNonNull</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> batchRemove<span style="color:#f92672">(</span>c<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">retainAll</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">requireNonNull</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> batchRemove<span style="color:#f92672">(</span>c<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">batchRemove</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?&gt;</span> c<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> complement<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> elementData <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">elementData</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> 0<span style="color:#f92672">,</span> w <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">boolean</span> modified <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(;</span> r <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> r<span style="color:#f92672">++)</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>c<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">[</span>r<span style="color:#f92672">])</span> <span style="color:#f92672">==</span> complement<span style="color:#f92672">)</span>
                elementData<span style="color:#f92672">[</span>w<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> elementData<span style="color:#f92672">[</span>r<span style="color:#f92672">];</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Preserve behavioral compatibility with AbstractCollection,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// even if c.contains() throws.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>r <span style="color:#f92672">!=</span> size<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> r<span style="color:#f92672">,</span>
                             elementData<span style="color:#f92672">,</span> w<span style="color:#f92672">,</span>
                             size <span style="color:#f92672">-</span> r<span style="color:#f92672">);</span>
            w <span style="color:#f92672">+=</span> size <span style="color:#f92672">-</span> r<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>w <span style="color:#f92672">!=</span> size<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// clear to let GC do its work
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> w<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> size<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span>
                elementData<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
            modCount <span style="color:#f92672">+=</span> size <span style="color:#f92672">-</span> w<span style="color:#f92672">;</span>
            size <span style="color:#f92672">=</span> w<span style="color:#f92672">;</span>
            modified <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> modified<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h6 id="12-arraylist扩容机制和相关add功能函数源码分析">12. ArrayList扩容机制和相关add功能函数源码分析</h6>
<pre><code class="language-mermaid" data-lang="mermaid">graph LR
add--&gt;ensureCapacityInternal
ensureCapacityInternal--&gt;ensureExplicitCapacity
ensureExplicitCapacity--&gt;grow
grow--&gt;hugeCapacity
addAll--&gt;ensureCapacityInternal
</code></pre><p>add函数： 将指定的元素追加到列表末尾。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>E e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//将列表进行扩容
</span><span style="color:#75715e"></span>    ensureCapacityInternal<span style="color:#f92672">(</span>size <span style="color:#f92672">+</span> 1<span style="color:#f92672">);</span> <span style="color:#75715e">// Increments modCount!!
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//将指定的元素插入到列表末尾
</span><span style="color:#75715e"></span>    elementData<span style="color:#f92672">[</span>size<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> e<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>add(int index, E element)函数： 将指定的元素插入到列表指定的位置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">,</span> E element<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//检查传入参数index是否小于列表size
</span><span style="color:#75715e"></span>    rangeCheckForAdd<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
    <span style="color:#75715e">//列表扩容
</span><span style="color:#75715e"></span>    ensureCapacityInternal<span style="color:#f92672">(</span>size <span style="color:#f92672">+</span> 1<span style="color:#f92672">);</span> <span style="color:#75715e">// Increments modCount!!
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//将列表index之后的数据全部往后移一位
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> index <span style="color:#f92672">+</span> 1<span style="color:#f92672">,</span> size <span style="color:#f92672">-</span> index<span style="color:#f92672">);</span>
    <span style="color:#75715e">//将列表index位置设置成element
</span><span style="color:#75715e"></span>    elementData<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> element<span style="color:#f92672">;</span>
    size<span style="color:#f92672">++;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>addAll函数： 将指定的集合放在列表的末尾。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> E<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Object<span style="color:#f92672">[]</span> a <span style="color:#f92672">=</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">int</span> numNew <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    ensureCapacityInternal<span style="color:#f92672">(</span>size <span style="color:#f92672">+</span> numNew<span style="color:#f92672">);</span> <span style="color:#75715e">//Increments modCount
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>a<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> size<span style="color:#f92672">,</span> numNew<span style="color:#f92672">);</span>
    size <span style="color:#f92672">+=</span> numNew<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">return</span> numNew <span style="color:#f92672">!=</span> 0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>addAll(int index, Collection&lt;? extends E&gt; c)函数： 将指定的集合插入到列表指定位置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">,</span> Collection<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> E<span style="color:#f92672">&gt;</span> c<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    rangeCheckForAdd<span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
    
    Object<span style="color:#f92672">[]</span> a <span style="color:#f92672">=</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">int</span> numNew <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    ensureCapacityInternal<span style="color:#f92672">(</span>size <span style="color:#f92672">+</span> numNew<span style="color:#f92672">);</span> <span style="color:#75715e">//Increments modCount
</span><span style="color:#75715e"></span>    
    <span style="color:#66d9ef">int</span> numMoved <span style="color:#f92672">=</span> size <span style="color:#f92672">-</span> index<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>numMoved <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> index <span style="color:#f92672">+</span> numNew<span style="color:#f92672">,</span> numMoved<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">arraycopy</span><span style="color:#f92672">(</span>a<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> elementData<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> numNew<span style="color:#f92672">);</span>
    size <span style="color:#f92672">+=</span> numNew<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">return</span> numNew <span style="color:#f92672">!=</span> 0<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ensureCapacity函数： 这个函数主要实现列表扩容机制，但是主要是被ArrayList外部的代码调用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ensureCapacity</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> minCapacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> minExpand <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>elementData <span style="color:#f92672">!=</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span style="color:#f92672">)</span>
            <span style="color:#75715e">// any size if not default element table
</span><span style="color:#75715e"></span>            <span style="color:#f92672">?</span> 0
            <span style="color:#75715e">// larger than default for default empty table. It&#39;s already
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// supposed to be at default size.
</span><span style="color:#75715e"></span>            <span style="color:#f92672">:</span> DEFAULT_CAPACITY<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>minCapacity <span style="color:#f92672">&gt;</span> minExpand<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ensureExplicitCapacity<span style="color:#f92672">(</span>minCapacity<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>ensureCapacityInternal函数： 该函数会得到列表的最小扩容量，然后调用ensureExplicitCapacity函数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ensureCapacityInternal</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> minCapacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>elementData <span style="color:#f92672">==</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        minCapacity <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">max</span><span style="color:#f92672">(</span>DEFAULT_CAPACITY<span style="color:#f92672">,</span> minCapacity<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
    ensureExplicitCapacity<span style="color:#f92672">(</span>minCapacity<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ensureExplicitCapacity函数： 判断列表是否需要扩容，需要扩容的话调用grow函数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ensureExplicitCapacity</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> minCapacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    modCount <span style="color:#f92672">++;</span>
    
    <span style="color:#75715e">//overflow-conscious code
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>minCapacity <span style="color:#f92672">-</span> elementData<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span>
        grow<span style="color:#f92672">(</span>minCapacity<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>grow函数： 对列表进行扩容以保证列表能有足够的空间放下一定的元素。
注：Integer.MAX_VALUE： 2<!-- raw HTML omitted -->31<!-- raw HTML omitted -->-1   0x7fffffff</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* The maximum size of array to allocate.
</span><span style="color:#75715e">* Some VMs reserve some header words in an array
</span><span style="color:#75715e">* Attempts to allocate larger arrays may result in
</span><span style="color:#75715e">* OutOfMemoryError: Requested array size exceeds VM limit
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MAX_ARRAY_SIZE <span style="color:#f92672">=</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MAX_VALUE</span> <span style="color:#f92672">-</span> 8<span style="color:#f92672">;</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">grow</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> minCapacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//overflow-conscious code
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> oldCapacity <span style="color:#f92672">=</span> elementData<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">//将oldCapacity 右移一位，其效果相当于oldCapacity /2，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//我们知道位运算的速度远远快于整除运算，整句运算式的结果就是将新容量更新为旧容量的1.5倍，
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> newCapacity <span style="color:#f92672">=</span> oldCapacity <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>oldCapacity <span style="color:#f92672">&gt;&gt;</span> 1<span style="color:#f92672">);</span> 
    <span style="color:#75715e">//然后检查新容量是否大于最小需要容量，若还是小于最小需要容量，那么就把最小需要容量当作数组的新容量，
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>newCapacity <span style="color:#f92672">-</span> minCapacity <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span>
        newCapacity <span style="color:#f92672">=</span> minCapacity<span style="color:#f92672">;</span>
    <span style="color:#75715e">//再检查新容量是否超出了ArrayList所定义的最大容量，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//若超出了，则调用hugeCapacity()来比较minCapacity和 MAX_ARRAY_SIZE，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//如果minCapacity大于MAX_ARRAY_SIZE，则新容量则为Interger.MAX_VALUE，否则，新容量大小则为 MAX_ARRAY_SIZE。
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>newCapacity <span style="color:#f92672">-</span> MAX_ARRAY_SIZE <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> 
        newCapacity <span style="color:#f92672">=</span> hugeCapacity<span style="color:#f92672">(</span>minCapacity<span style="color:#f92672">);</span>
    <span style="color:#75715e">// minCapacity is usually close to size, so this is a win
</span><span style="color:#75715e"></span>    elementData <span style="color:#f92672">=</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">copyOf</span><span style="color:#f92672">(</span>elementData<span style="color:#f92672">,</span> newCapacity<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">hugeCapacity</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> minCapacity<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// 该函数通过比较minCapacity与列表容许最大容量值来得出列表需要进行扩容的新容量
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>minCapacity <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#75715e">//overflow
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> OutOfMemoryError<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>minCapacity <span style="color:#f92672">&gt;</span> MAX_ARRAY_SIZE<span style="color:#f92672">)</span> <span style="color:#f92672">?</span> Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">MAX_VALUE</span> <span style="color:#f92672">:</span> MAX_ARRAY_SIZE<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
